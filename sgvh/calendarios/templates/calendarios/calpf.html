{% extends 'calendarios/baseCPF.html' %}

{% block content %}
<div class="container">
    <h2>Calendario de Programas de Formación</h2>
    <label for="programaSelect">Selecciona un Programa de Formación:</label>
    <select id="programaSelect" class="form-control">
        <option value="">--Selecciona un Programa de Formación--</option>
        {% for programa in programas %}
            <option value="{{ programa.id }}">{{ programa.nombre_programa }}</option>
        {% endfor %}
    </select>

    <div id='calendar'></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            locale: 'es',
            events: function(fetchInfo, successCallback, failureCallback) {
                var programaId = document.getElementById('programaSelect').value;
                if (programaId) {
                    fetch('/calendarios/get_programa_events/' + programaId + '/')
                        .then(response => response.json())
                        .then(data => successCallback(data))
                        .catch(error => failureCallback(error));
                } else {
                    successCallback([]);
                }
            }
        });
        calendar.render();

        document.getElementById('programaSelect').addEventListener('change', function() {
            calendar.refetchEvents();
        });
    });
</script>
{% endblock %}
